# ROGUES ゲーム設計 Docs

## 0. ドキュメント方針

- 本ドキュメントは **AI がコーディング／マップ生成／キャラクター生成を行う前提**での仕様書。
- 明確に決めた項目はそのまま記述。
- まだ検討中・変更可能性が高い項目には **[WIP]** タグを付与する。
- **AIからの報告・コミュニケーション**: ユーザーへの報告、質問、確認等は原則として **日本語** で行う。

---

## 1. ゲーム概要

- タイトル（仮）：**ROGUES**
- ジャンル：見下ろし2Dアクション / ローグライク / サバイバルクラフト / エクストラクションライク
- 視点：トップダウン（見下ろし）
- テーマ：
  - 危険なエリアに潜って資源・装備を集める
  - 生きて脱出すれば持ち帰り、死亡すると多くを失う（タルコフライク）
- 今回のプロトタイプ範囲：
  - **探索フェーズ**
  - **戦闘フェーズ**
- 今回は含めないが将来実装予定の要素 [WIP]
  - 拠点フェーズ（倉庫、クラフト、出撃準備 等）
  - メタ進行（拠点拡張、レシピ解放 等）

---

## 2. 対象プラットフォーム & 表現

- 対象デバイス：スマートフォン（iOS / Android）  
  - 第一ターゲット：スマホブラウザ or ネイティブビルドで動作する形
- 画面方向：**縦画面（ポートレート）**
  - 片手操作（親指）をベースとした操作体系
  - 白猫プロジェクトやモンスターハンターのスマホ版のように、片手で探索・戦闘を完結させるイメージ
- グラフィック表現：
  - **2D トップダウン**を採用  
    - 理由：  
      - AI がタイルマップやスプライトをテキストベースで扱いやすい  
      - 画像生成AIでのスプライト／アニメーション素材の量産がしやすい  
      - 物理・化学システムも 2D の方が仕様を単純化できる
- 3D / 擬似3D 対応 [WIP]
  - 将来的に 3D 化や擬似3D 表現（高さ、段差 等）を追加する可能性あり

---

## 3. 技術スタック（AI フレンドリー優先）

### 3.1 言語・ランタイム

- 言語：**TypeScript**
  - 型情報があることで AI がコードの意図を理解しやすい
  - 大規模化してもリファクタリングや自動生成がしやすい
- 実行環境：
  - ブラウザ上で動作する Web ゲームとして構築
  - 開発時は PC ブラウザ、デバッグ後にスマホブラウザで確認
  - 必要に応じて Capacitor / Cordova 等でネイティブラップ [WIP]

### 3.2 ゲームフレームワーク

- フレームワーク：**Phaser 3（+ Matter.js 物理）** を想定
  - 利点：
    - 2D フレームワークとして成熟している
    - シーン管理、スプライト、アニメーション、入力、物理などが一通り揃っている
    - 物理エンジンとして Matter.js を利用できる → BotW ライクな物理を 2D で再現しやすい
    - すべてコードベースで完結し、AI がテキストとして編集しやすい
- フレームワーク候補 [WIP]
  - Godot 4（GDScript）  
  - Unity 2D（C#）  
  → 将来、必要に応じてエンジンを切り替える可能性あり（現時点では Phaser + TS 前提で進行）

### 3.3 プロジェクト構成（例）

※ これは AI が扱いやすい構成例であり、詳細は[WIP]

- `src/`
  - `game/`
    - `scenes/`（タイトル、ゲーム本編など）
    - `entities/`（プレイヤー、敵、オブジェクト）
    - `systems/`（物理拡張、化学エンジン、AI 等）
    - `ui/`（HPバー、ボタン 等）
  - `assets/`
    - `sprites/`
    - `tilesets/`
    - `maps/`（JSON など）
    - `audio/`
- `config/` [WIP]  
  各種バランス調整用の JSON / YAML 等を置く想定

---

## 4. 入力設計（スマホ）

### 4.1 決定済み操作（片手操作ベース）

- 基本コンセプト：
  - スマホを片手で持ち、その手の親指だけで**移動・攻撃・回避**のすべてを行えることを目標とする
  - 画面下半分を「操作エリア」、上半分を「フィールド表示優先エリア」とする

- **移動：フローティングジョイスティック（ドラッグ移動）**
  - 画面下半分の任意の位置をタッチすると、その位置を中心とした「フローティングジョイスティック」が出現
  - 指をスライドした方向・距離に応じて 360°移動
  - スティックの倒し量で移動速度を変化（一定以上でダッシュ扱いも可）
  - 指を離すと移動停止

- **攻撃：タップ攻撃（近接）**
  - 画面下半分で「短いタップ（ほとんど移動しない）」を検出した場合、**プレイヤー周囲への近接攻撃（360°）**を行う
  - 現時点ではタップ位置の方向は使わず、「プレイヤー中心の範囲攻撃」として実装
  - 将来的に「タップ方向への攻撃」や「射撃攻撃」に拡張する余地を残す [WIP]

- **回避：フリック（スワイプ）回避**
  - 画面下半分で「一定速度以上の素早いスワイプ」を検出した場合、**スワイプ方向に短距離ダッシュ（回避）**
  - 回避中は短時間の無敵時間（iフレーム）を付与
  - スタミナを消費
  - 時間・距離・速度の閾値により、移動ドラッグとフリック回避を判定する

### 4.2 拡張予定の操作 [WIP]

- ロングタップ：チャージ攻撃、強攻撃
- ロングタップ中に指定方向移動：チャージしながら突進攻撃
- 攻撃中のスワイプ：攻撃しながら移動（移動攻撃）
- マルチタッチの組み合わせによる高度なアクション

### 4.3 反対の手を使う操作 [WIP]

- クラフトやクラフトアイテム使用など、戦闘の合間に行う操作は**反対の手**で行う想定
  - 例：画面上部または左右上部にクラフトメニュー／アイテムスロットを配置
  - 片手で探索・戦闘を継続しながら、もう一方の手でクラフトやアイテム選択を行えるUI
- プロトタイプ段階では、クラフトUIや複雑なアイテム使用UIは実装対象外とし、「片手操作の探索＆戦闘」を優先する

---

## 5. プロトタイプのスコープ

- 対象フェーズ：
  - **探索フェーズ**
  - **戦闘フェーズ**
- 実装しない（後続）フェーズ [WIP]
  - 拠点フェーズ（倉庫管理、クラフトUI 等）
  - メタ進行・拠点拡張
  - 脱出結果の長期的反映

### 5.1 サバイバルクラフト基盤（今回着手）

- 探索中に **木材・鉱石・金属スクラップ・薬草** を採取して、簡易クラフトや脱出持ち帰りに利用する。
- 収集した資源はインベントリに保持。重量やスロット上限はシンプルなルールから始める。
- マップ内に **簡易ベース（ベースノード）** を置き、そこでクラフト／資源預け／脱出が行える。
- 今回はクラフト＆資源周りを優先し、メタ進行や本格的な拠点拡張はWIPとする。

#### 採取できる資源カテゴリ
- **木材 (Wood)**: 倒木や木箱から取得。クラフトの汎用素材。
- **鉱石 (Ore)**: 岩場を破壊して取得。金属装備や炎ギミック向け。
- **金属スクラップ (Scrap)**: 廃墟・機械残骸から取得。弾薬や機械系クラフトに使用。
- **薬草 (Herb)**: 茂み/植物から取得。回復系クラフト向け。

#### 加工 / クラフトの最小ラインナップ
| レシピ | 必要素材 | 効果 |
| --- | --- | --- |
| Campfire Kit | Wood ×3 + Ore ×1 | ベースノード上で設置。設置中は回復効果や一時バフ（将来拡張）|
| Health Salve | Herb ×2 + Scrap ×1 | 応急回復アイテムを生成 |
| Arrow Bundle | Wood ×1 + Scrap ×2 | プレイヤーの遠距離攻撃用弾薬を生成 |

#### 収納 / 重量ルール
- プレイヤーインベントリ: 8 スロット、各スロットに 10 個までスタック。
- ただし総重量（例: Wood 1、Ore 2 等）に応じて移動速度に補正をかける（上限超過で速度低下）。
- BaseNode に預けた資源は重量に計上されず、探索中のクラフトにも利用できる。

#### Base/Home Node
- マップに 1 箇所以上設置。安全地帯として機能。
- インタラクトするとインベントリUI・クラフトUIを開き、資源預け・クラフト・脱出を行える。
- 脱出時は持ち物を持ち帰り（将来の拠点フェーズで利用）とする。

#### 今後のサバイバル要素 [WIP]
- 空腹/喉の渇き/気温などの状態管理。
- ベースの拡張（クラフト速度・収納拡張等）。
- 多段階クラフト（素材 → 中間部品 → 装備）。

---

## 6. コアゲームループ（今回範囲）

1. プレイヤーが探索マップにスポーン
2. バーチャルジョイスティックでマップを移動
3. 敵と遭遇し、タップ攻撃／スワイプ回避で戦う
4. マップ内の一部エリアに到達すると「探索終了」または「簡易脱出」
5. HP0 で死亡した場合はその場でゲームオーバー
6. （将来）獲得アイテムや戦績を拠点に反映 [WIP]

---

## 7. ゲームシステム仕様（探索＆戦闘）

### 7.1 プレイヤー

- ステータス：
  - HP
  - スタミナ（ダッシュ／回避／重い攻撃で消費）
  - 攻撃力 / 防御力（装備込み）
  - 状態異常タグ（`WET`, `ON_FIRE`, `ELECTRIFIED`, `OILED` 等）
- 行動：
  - 移動：ジョイスティック方向へ移動
  - 攻撃：タップ方向へ近接 or 遠距離攻撃
  - 回避：スワイプ方向へ短距離ダッシュ（スタミナ消費、短時間無敵）
- 化学状態との連動：
  - `ON_FIRE`: 一定間隔で継続ダメージ
  - `WET`: `ELECTRIC` 属性攻撃に弱くなる 等

### 7.2 敵

- 種類（最低限）：
  - 近接型：プレイヤーに近づいて接触攻撃
  - 遠距離型：一定距離を保ちつつ射撃
- AI 状態：
  - 徘徊 → プレイヤー発見 → 追跡 → 攻撃 → 見失う
- 物理・化学との関係：
  - ノックバックを受ける（爆発や強攻撃）
  - `ON_FIRE`, `WET` 等の状態を持つことで追加効果を受ける

### 7.3 マップ

- 2D タイルベースのフィールド
- 障害物（壁、岩、箱 等）と通行可能エリア
- 物理オブジェクト：
  - 押したり、ぶつけたりできる箱・樽・岩
  - 爆発で吹き飛ぶオブジェクト

---

## 8. 物理エンジン（BotW ライク物理・2D版）

### 8.1 基本方針

- Phaser + Matter.js による 2D 物理を使用
- 主な対象：
  - プレイヤー、敵（動的剛体）
  - 箱・樽・岩などのギミックオブジェクト（動的 or 静的剛体）
- 必須挙動：
  - 攻撃や爆発によるノックバック
  - 押せる・転がせるオブジェクト

### 8.2 物理パラメータ（例）

- 各オブジェクトは以下を持つ：
  - `mass`（質量）
  - `friction`（摩擦係数）
  - `restitution`（反発係数）
  - `isStatic` / `isDynamic`
- 攻撃：
  - 通常攻撃：小さなインパルスを敵やオブジェクトに付与
  - 爆発：範囲内のオブジェクトに距離減衰付きの大きなインパルスを付与

---

## 9. 化学エンジン（状態 × 属性）

### 9.1 コンセプト

- BotW の「物理＋化学」のうち、**状態タグと属性の組合せ**を 2D で再現
- シンプルな「タグベース」のシステムにすることで AI が制御しやすくする

### 9.2 状態タグの例

- `WET`（濡れ）
- `ON_FIRE`（燃焼）
- `ELECTRIFIED`（感電）
- `OILED`（油まみれ）

### 9.3 属性の例

- 攻撃・オブジェクト側が持つ属性：
  - `FIRE`（火）
  - `WATER`（水）
  - `ELECTRIC`（雷）
  - `WIND`（風 / 吹き飛ばし）
  - `EXPLOSIVE`（爆発）

### 9.4 代表的な相互作用（プロトタイプで実装候補）

1. FIRE × 可燃物
   - 可燃タグ（木箱、草 等）に FIRE 属性攻撃 → `ON_FIRE` 付与
   - `ON_FIRE` オブジェクトは近くの可燃物に火を伝播
2. WATER × FIRE
   - WATER 属性攻撃 or 水たまり → `ON_FIRE` 状態を解除し `WET` 状態に
3. WATER × ELECTRIC
   - `WET` 状態中に `ELECTRIC` 属性攻撃を受けると追加ダメージ＋スタン
4. OIL × FIRE
   - `OILED` 状態 or 油溜まりに FIRE → 大きな火力・広範囲燃焼

### 9.5 実装イメージ

- 各キャラ／オブジェクトに `chemicalState` コンポーネントを付与：
  - 持つ情報：
    - 現在の状態タグ（複数）
    - 各状態の残り時間
- 攻撃ヒット時：
  - 攻撃の属性と対象の状態を `ChemicalSystem` に渡す
  - `ChemicalSystem` が「新たな状態の付与／解除」「追加ダメージ」「スタン」などを返す
- 毎フレーム／一定間隔処理：
  - 状態の残り時間を減算
  - `ON_FIRE` などの継続効果を適用

---

## 10. AI による制作方針

### 10.1 コーディング

- すべてのゲームロジックは TypeScript で実装
- クラス／関数は責務ごとに分割し、AI が理解しやすい命名を採用
- AI に依頼するときの基本方針：
  - 「どのディレクトリのどのファイルを」「どの仕様に基づいて」変更するかを明示
  - 物理・化学・UI などのシステム境界を保つ

### 10.2 マップ生成

- 初期は手書き JSON マップ or 単純な手続き生成コードを AI が生成
- タイルセットとオブジェクト配置情報も JSON で管理して AI が編集可能にする
- 複雑なランダム生成アルゴリズムは段階的に追加 [WIP]

### 10.3 キャラクター・アニメーション

- 2D スプライトベース
  - 立ち／歩き／攻撃／ダメージ／死亡 など最低限のアニメーション
- 画像生成AIで各フレームを生成し、AI によってスプライトシートにまとめる運用 [WIP]
- アニメーション定義：
  - Phaser のアニメーション設定を TypeScript コードまたは JSON で一元管理

---

## 11. 将来拡張（メモ）[WIP]

- 拠点フェーズ（倉庫、クラフト、出撃準備）
- メタ進行（拠点・装備・スキルツリー）
- マルチプレイ（協力・対人）
- 新マップ・新属性・新ギミックの追加
- 3D 化／擬似3D 表現の導入
